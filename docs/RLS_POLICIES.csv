Table,Policy Name,Policy Type,Roles,Condition,Access Level,Notes
users,users_select_self,SELECT,"all roles","auth_user_id = auth.uid()","READ","Own user record"
users,users_select_tenant,SELECT,"admin, staff","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant users"
users,users_select_super_admin,SELECT,"super_admin","true","READ","Full access"
users,users_insert_auth_user,INSERT,"authenticated","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid()) AND role = 'customer'","CREATE","Customer registration"
users,users_update_self,UPDATE,"all roles","auth_user_id = auth.uid()","WRITE","Own record"
users,users_update_tenant_admin,UPDATE,"admin, tenant_admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","WRITE","Tenant records"
webauthn_credentials,webauthn_select_own,SELECT,"authenticated","user_id = auth.uid()","READ","Own credentials"
webauthn_credentials,webauthn_insert_own,INSERT,"authenticated","user_id = auth.uid()","CREATE","Register new credential"
webauthn_credentials,webauthn_delete_own,DELETE,"authenticated","user_id = auth.uid()","DELETE","Remove credential"
appointments,appointments_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant appointments"
appointments,appointments_select_customer,SELECT,"customer","user_id = auth.uid() OR staff_id = auth.uid()","READ","Own appointments"
appointments,appointments_select_anon,SELECT,"anon","false","READ","None"
appointments,appointments_insert_staff,INSERT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","CREATE","Staff create"
appointments,appointments_update_staff,UPDATE,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","WRITE","Staff update"
appointments,appointments_delete_staff,DELETE,"admin, staff","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","DELETE","Staff delete"
payments,payments_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant payments"
payments,payments_select_customer,SELECT,"customer","user_id = auth.uid()","READ","Own payments"
payments,payments_insert_customer,INSERT,"customer","user_id = auth.uid()","CREATE","Create own payment"
payments,payments_insert_anon,INSERT,"anon","true","CREATE","Public payment creation"
payments,payments_insert_service_role,INSERT,"service_role","true","CREATE","Service role (backend)"
payments,payments_update_staff,UPDATE,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","WRITE","Staff update"
payments,payments_update_service_role,UPDATE,"service_role","true","WRITE","Service role update"
payments,payments_select_service_role,SELECT,"service_role","true","READ","Service role read"
availability_slots,availability_slots_select_public,SELECT,"anon","available = true","READ","Available slots"
availability_slots,availability_slots_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","All slots"
availability_slots,availability_slots_update_anon,UPDATE,"anon","appointment_id IS NULL","WRITE","Reserve slot"
availability_slots,availability_slots_update_staff,UPDATE,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","WRITE","Staff update"
availability_slots,availability_slots_insert_service_role,INSERT,"service_role","true","CREATE","Service role (backend)"
categories,categories_select_public,SELECT,"anon","active = true","READ","Active categories"
categories,categories_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","All categories"
categories,categories_insert_staff,INSERT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","CREATE","Staff create"
booking_proposals,booking_proposals_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant proposals"
booking_proposals,booking_proposals_insert_anon,INSERT,"anon","true","CREATE","Public submission"
booking_proposals,booking_proposals_insert_authenticated,INSERT,"authenticated","true","CREATE","Authenticated submission"
locations,locations_select_public,SELECT,"anon","bookable = true","READ","Bookable locations"
locations,locations_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant locations"
locations,locations_insert_staff,INSERT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","CREATE","Staff create"
staff_working_hours,staff_working_hours_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant hours"
staff_working_hours,staff_working_hours_select_own,SELECT,"staff","staff_id = auth.uid()","READ","Own hours"
staff_working_hours,staff_working_hours_insert_staff,INSERT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","CREATE","Staff create"
staff_working_hours,staff_working_hours_update_staff,UPDATE,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","WRITE","Staff update"
student_credits,student_credits_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant credits"
student_credits,student_credits_select_customer,SELECT,"customer","user_id = auth.uid()","READ","Own credits"
invoices,invoices_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant invoices"
invoices,invoices_select_customer,SELECT,"customer","user_id = auth.uid()","READ","Own invoices"
invoices,invoices_insert_staff,INSERT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","CREATE","Staff create"
discount_codes,discount_codes_select_public,SELECT,"anon","active = true AND expires_at > now()","READ","Valid codes"
discount_codes,discount_codes_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","All codes"
audit_logs,audit_logs_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant logs"
audit_logs,audit_logs_select_super_admin,SELECT,"super_admin","true","READ","Full logs"
audit_logs,audit_logs_insert_service_role,INSERT,"service_role","true","CREATE","Service role (backend)"
error_logs,error_logs_select_admin,SELECT,"admin, tenant_admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant errors"
error_logs,error_logs_select_super_admin,SELECT,"super_admin","true","READ","All errors"
error_logs,error_logs_insert_service_role,INSERT,"service_role","true","CREATE","Service role (backend)"
webhook_logs,webhook_logs_select_admin,SELECT,"admin, tenant_admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant webhooks"
webhook_logs,webhook_logs_insert_service_role,INSERT,"service_role","true","CREATE","Service role (backend)"
payment_reminders,payment_reminders_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant reminders"
payment_reminders,payment_reminders_insert_service_role,INSERT,"service_role","true","CREATE","Service role (backend)"
payment_reminders,payment_reminders_update_service_role,UPDATE,"service_role","true","WRITE","Service role (backend)"
course_registrations,course_registrations_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant registrations"
course_registrations,course_registrations_select_customer,SELECT,"customer","user_id = auth.uid()","READ","Own registrations"
course_registrations,course_registrations_insert_service_role,INSERT,"service_role","true","CREATE","Service role (backend)"
course_registrations,course_registrations_insert_staff,INSERT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","CREATE","Staff create"
sari_sync_logs,sari_sync_logs_select_admin,SELECT,"admin, tenant_admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant logs"
sari_sync_logs,sari_sync_logs_insert_service_role,INSERT,"service_role","true","CREATE","Service role (backend)"
sari_customer_mapping,sari_mapping_select_admin,SELECT,"admin, tenant_admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant mappings"
sari_customer_mapping,sari_mapping_insert_service_role,INSERT,"service_role","true","CREATE","Service role (backend)"
notes,notes_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant notes"
notes,notes_select_customer,SELECT,"customer","user_id = auth.uid()","READ","Own notes"
notes,notes_insert_staff,INSERT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","CREATE","Staff create"
pendencies,pendencies_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant tasks"
pendencies,pendencies_select_assigned,SELECT,"customer","user_id = auth.uid()","READ","Assigned tasks"
pendencies,pendencies_insert_staff,INSERT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","CREATE","Staff create"
external_calendars,external_calendars_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant calendars"
external_calendars,external_calendars_select_own,SELECT,"staff","staff_id = auth.uid()","READ","Own calendar"
external_calendars,external_calendars_insert_staff,INSERT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","CREATE","Staff create"
user_documents,user_documents_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant documents"
user_documents,user_documents_select_customer,SELECT,"customer","user_id = auth.uid()","READ","Own documents"
user_documents,user_documents_insert_customer,INSERT,"customer","user_id = auth.uid()","CREATE","Upload own"
cash_balances,cash_balances_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant balances"
cash_balances,cash_balances_select_own,SELECT,"staff","staff_id = auth.uid()","READ","Own balance"
discount_sales,discount_sales_select_tenant,SELECT,"staff, admin","tenant_id IN (SELECT tenant_id FROM users WHERE auth_user_id = auth.uid())","READ","Tenant sales"
outbound_messages_queue,outbound_messages_insert_service_role,INSERT,"service_role","true","CREATE","Service role (backend)"
outbound_messages_queue,outbound_messages_update_service_role,UPDATE,"service_role","true","WRITE","Service role (backend)"
outbound_messages_queue,outbound_messages_select_service_role,SELECT,"service_role","true","READ","Service role (backend)"
