Flow Name,Process Description,Participants,Key Tables,Steps,Trigger,Outcome,Dependencies
User Registration,New user account creation,"Customer, Auth Service","users, auth.users, webauthn_sessions","1. Email/password submission 2. Password validation 3. WebAuthn option 4. Account creation 5. Session init","Registration button click","Active user account with JWT token","auth.users table, email validation"
Authentication Flow,User login process,"Customer, Auth Service","users, auth.users, login_attempts, mfa_methods","1. Email/password input 2. Credential check 3. MFA check 4. Failed attempt tracking 5. JWT generation","Login button click","JWT token for session management","auth.users table, IP tracking"
WebAuthn Registration,Passkey/biometric setup,"User, Browser, Auth Service","users, webauthn_credentials, webauthn_sessions","1. Challenge generation 2. Browser verification 3. Credential storage 4. Device naming","Add new device button","Stored credential for future auth","Browser WebAuthn support"
Appointment Creation,Book new driving lesson,"Customer/Staff, Booking Engine, Calendar","appointments, availability_slots, payments, notifications","1. Availability check 2. Slot selection 3. User/staff assignment 4. Price calc 5. Payment request 6. Confirmation email","Booking submission","Scheduled appointment with payment","availability_slots pre-computed"
Payment Processing,Handle payment transaction,"Customer, Payment Gateway (Wallee/Stripe), System","payments, payment_items, payment_wallee_transactions, payment_reminders","1. Payment form submit 2. Validation 3. Gateway call 4. Transaction creation 5. Webhook receive 6. Status update 7. Receipt email","Payment action","Confirmed payment with receipt","Wallee/Stripe API configured"
Payment Reminder,Multi-stage payment follow-up,"System, Customer, Email/SMS","payments, payment_reminders, reminder_templates, outbound_messages_queue","1. Payment pending check 2. Stage determination 3. Template render 4. Email/SMS queue 5. Send via provider 6. Log sending","Cron job (stages at 1/3/7 days)","Customer receives reminder message","Twilio/Resend configured, templates set"
Availability Recalculation,Pre-compute available slots,"System, Staff, Calendar","availability_slots, availability_recalc_queue, staff_working_hours, appointments","1. Queue entry creation 2. Working hours check 3. Appointment conflicts 4. Slot generation 5. Queue mark processed","Staff hours update, appointments change, cron trigger","Pre-computed slots for booking","staff_working_hours table populated"
External Calendar Sync,Sync busy times from Google/Outlook,"Staff, External Calendar, System","external_calendars, appointments, availability_recalc_queue","1. Calendar token validation 2. ICS/API fetch 3. Event parsing 4. Busy time detection 5. Recalc queue trigger","Daily cron, manual sync","Updated availability reflect busy times","ICS feed URL, API access configured"
Course Enrollment,Student joins course with payment,"Student, Payment, Course System","course_registrations, courses, payments, invoices, sari_sync_logs","1. Course selection 2. Payment processing 3. Enrollment creation 4. SARI sync (VKU) 5. Invoice generation 6. Confirmation","Enrollment form submit","Registered student in course","courses table, course_registrations, Wallee configured"
SARI Course Sync,Sync VKU/PGS courses from SARI,"System, SARI API","courses, sari_sync_logs, sari_course_mapping","1. SARI API connect 2. Course fetch 3. Category mapping 4. Insert/update courses 5. Sync log","Cron job (daily or on-demand)","Courses up-to-date with SARI system","SARI API credentials, environment config"
SARI Student Enrollment,Sync student enrollment to SARI,"System, SARI API","course_registrations, sari_customer_mapping, sari_sync_logs","1. SARI ID lookup 2. Course mapping 3. Enrollment data build 4. SARI API call 5. Confirmation log","Course enrollment completion","Student synced to SARI system","SARI API, customer mapping maintained"
Cash Payment Recording,Record cash payment for appointment,"Staff, System","payments, cash_balances, cash_transactions, cash_confirmations","1. Appointment selected 2. Amount input 3. Payment record creation 4. Cash balance update 5. Receipt generation 6. Confirmation number","Create cash payment button","Recorded transaction, updated balance","cash_balances table"
Invoice Generation,Create invoice from appointments/courses,"Admin/Staff, System","invoices, invoice_items, payments, appointments, courses","1. Selection of items 2. Invoice template apply 3. Item calculation 4. Total computation 5. Payment status link 6. PDF generation","Invoice creation form","Invoice record with PDF download","invoices table, jsPDF library"
Cancellation Processing,Handle appointment cancellation,"Customer/Staff, System, Finance","appointments, payments, cancellation_policies, pendencies","1. Cancellation request 2. Policy lookup 3. Charge calculation 4. Medical cert check 5. Payment creation/reversal 6. Status update 7. Notification","Cancellation button","Updated appointment status, financial record","cancellation_policies table"
Role-Based Access,Grant/restrict user permissions,"System, Database","users, audit_logs","1. User role fetch 2. RLS policy check 3. Access evaluation 4. Log audit entry 5. Response grant/deny","Page load, API request","Authorized/denied access based on role","RLS policies configured"
Document Upload,User uploads required documents,"Customer/Staff, File Storage, System","user_documents, document_categories, audit_logs","1. File selection 2. Category selection 3. Validation (type/size) 4. Upload to storage 5. DB record creation 6. Audit log","Upload button","Stored document with metadata","document_categories defined"
Evaluation Recording,Staff evaluates appointment/student,"Staff, System","exam_results, evaluation_criteria, appointments, evaluation_categories","1. Appointment selection 2. Criteria display 3. Score input 4. Comments add 5. Record save 6. Statistics calc","Evaluation form submit","Stored evaluation with rating","evaluation_criteria table"
Tenant Branding,Display tenant-specific branding,"Booking/Customer Interface, Tenant System","tenants, tenant_settings, tenant_assets","1. Tenant slug/ID lookup 2. Settings fetch 3. Logo/colors retrieve 4. CSS injection 5. Display render","Page load for tenant","Custom branded interface","tenant_assets storage"
Admin Fee Management,Charge admin fee to staff member,"Staff, System, Finance","payments, cash_balances, payment_items","1. Fee calculation 2. Payment creation 3. Item linkage 4. Cash balance reduction 5. Notification","Period-based trigger or manual","Admin fee recorded and tracked","pricing_rules configured"
Rate Limiting,Prevent abuse by tracking request rates,"System, Security","rate_limit_logs, login_attempts, blocked_ip_addresses","1. Request capture 2. IP/user tracking 3. Count increment 4. Threshold check 5. Block if exceeded 6. Log violation","Every API request","Request allowed or blocked, violation logged","rate_limit_logs table"
MFA Enforcement,Require multi-factor authentication,"User, Auth System","users, mfa_methods, mfa_verifications, mfa_login_codes","1. Login success 2. MFA method query 3. Code generation 4. Delivery (email) 5. User input 6. Verification 7. Grant access","Failed login attempts or admin mandate","MFA verified, session created","mfa_methods, mfa_login_codes tables"
Appointment Statistics,Generate staff performance stats,"Staff, Analytics, System","appointments, payments, evaluation_criteria, exam_results","1. Date range specify 2. Staff appointments fetch 3. Payment aggregation 4. Evaluation scores calc 5. Hours compute 6. Report generation","Dashboard load, analytics request","Displayed statistics and charts","appointments, payments tables"
Working Hours Update,Modify staff availability,"Staff, System, Availability","staff_working_hours, availability_recalc_queue","1. Hours form submit 2. Validation (day/time) 3. Record update 4. Recalc queue entry 5. Queue process","Save working hours button","Updated hours, slots recalculated","staff_working_hours table"
Credit System Usage,Student uses credit for appointment,"Customer, System, Finance","student_credits, credit_transactions, payments, appointments","1. Credit balance check 2. Amount verify 3. Credit transaction log 4. Payment creation 5. Credit deduction 6. Appointment link","Apply credit button","Credit consumed, appointment paid"," student_credits table"
Discount Code Validation,Apply discount to payment,"Customer, System, Finance","discount_codes, discounts, discount_sales, payments","1. Code input 2. Code lookup 3. Validity check (expiry, active) 4. Discount fetch 5. Amount calculation 6. Payment apply","Discount code entry","Discount applied to payment amount","discount_codes, discounts tables"
Appointment Status Batch Update,"Update multiple appointments at once","Admin, System","appointments, audit_logs","1. Appointment list select 2. Status select 3. Batch action submit 4. Loop through items 5. Update each record 6. Audit log entries","Batch action button","All appointments updated with audit trail","appointments table, audit_logs"
Email Template Rendering,Render dynamic email content,"System, Email Service","reminder_templates, reminder_logs, outbound_messages_queue","1. Template fetch 2. Variable substitution 3. User data insert 4. HTML render 5. Email queue 6. Provider send","Reminder send, email trigger","Sent email with dynamic content","reminder_templates table"
Wallee Payment Webhook,Handle payment provider callbacks,"Payment Provider (Wallee), System","payment_wallee_transactions, payments, payment_reminders","1. Webhook reception 2. Signature verify 3. Transaction ID match 4. Status update 5. Success/failure handle 6. Notification send","Wallee transaction event","Updated payment status from provider","Wallee webhook configured"
SMS Payment Reminder,Send SMS payment reminder to customer,"System, SMS Provider (Twilio), Customer","payments, payment_reminders, sms_logs, reminder_templates","1. Pending payment check 2. Stage determination 3. Phone number fetch 4. Template render 5. SMS queue 6. Twilio send 7. Log sent","Cron job payment reminder stage","Customer receives SMS reminder","Twilio account configured, templates"
Tenant Settings Management,Configure tenant-specific settings,"Tenant Admin, System","tenants, tenant_settings, sari_sync_logs","1. Settings form display 2. Current values fetch 3. Form update 4. Validation 5. Save to DB 6. Cache invalidate","Settings page submit","Updated tenant configuration","tenant_settings table"
