Table,Purpose,Key Columns,RLS Policy,Related Tables,Foreign Keys,Records Type
tenants,"Multi-tenant organization data","id, name, slug, email, created_at, updated_at","Tenant isolation - admin/staff full access, others select if linked","users, appointments, payments, courses, locations, categories, courses","--","1-N
users,"User accounts (staff, admins, customers)","id, auth_user_id, tenant_id, role, email, name, created_at","Tenant-based access + self-read, super_admin full access","auth.users, appointments, payments, webauthn_credentials, student_credits, audit_logs","auth.users(id), tenants(tenant_id)","1-N
auth.users,"Supabase authentication users","id, email, phone, encrypted_password, confirmed_at, last_sign_in_at","Managed by Supabase, referenced by users table","users","--","1-1
webauthn_credentials,"WebAuthn passkeys/security keys","id, user_id, credential_id, public_key, counter, transports, device_name, created_at, last_used_at","User self-read only","users","users(id)","1-N
webauthn_sessions,"WebAuthn authentication sessions","id, user_id, challenge, created_at, expires_at","User self-read only","users","users(id)","1-N
mfa_backup_codes,"MFA backup codes for account recovery","id, user_id, code, used_at, created_at","User self-read only","users","users(id)","1-N
mfa_verifications,"MFA verification event logs","id, user_id, method, verified_at, ip_address","User self-read + admin read","users","users(id)","1-N
mfa_methods,"MFA methods configuration per user","id, user_id, method_type, enabled, created_at","User self-read only","users","users(id)","1-N
mfa_login_codes,"Temporary MFA login codes","id, user_id, code, used_at, created_at, expires_at","User self-read only","users","users(id)","1-N
login_attempts,"Login attempt tracking for security","id, tenant_id, email, ip_address, user_agent, status, attempted_at","Admin read, service role insert","tenants, users","tenants(id)","1-N
login_security_rules,"Tenant-specific login security rules","id, tenant_id, max_failed_attempts, lockout_duration_minutes, created_at","Tenant admin only","tenants","tenants(id)","1-N
blocked_ip_addresses,"IP addresses blocked from login","id, tenant_id, ip_address, reason, blocked_at, unblocked_at","Tenant admin only","tenants","tenants(id)","1-N
password_reset_tokens,"Password reset tokens","id, user_id, token, expires_at, used_at","User self-access only","users","users(id)","1-N
password_strength_audits,"Password strength audit trail","id, user_id, score, feedback, created_at","Admin read + user self-read","users","users(id)","1-N
appointments,"Driving lesson appointments","id, tenant_id, user_id, staff_id, location_id, status, date, duration_minutes, notes, canceled_at, created_at","Tenant-based + customer self-read for own appointments","tenants, users, locations, payments, availability_slots, notes","tenants(id), users(id), locations(id)","1-N
locations,"Physical locations/addresses for appointments","id, tenant_id, name, street, postal_code, city, country, latitude, longitude, bookable, created_at","Tenant staff access, public read for available locations","tenants, appointments, staff_locations","tenants(id)","1-N
staff_locations,"Assignment of staff to locations","id, tenant_id, staff_id, location_id, bookable_online, bookable_in_person, created_at","Tenant staff access, own location self-read","tenants, users, locations","tenants(id), users(id), locations(id)","1-N
availability_slots,"Pre-computed available time slots for booking","id, tenant_id, staff_id, location_id, start_time, end_time, available, appointment_id, is_primary_reservation, created_at","Public read for available, tenant staff read all, anon update for reservations","tenants, users, locations, appointments","tenants(id), users(id), locations(id), appointments(id)","1-N
availability_recalc_queue,"Queue for recalculating availability slots","id, tenant_id, staff_id, location_id, priority, status, created_at, processed_at","Service role read/write, staff read own","tenants, users, locations","tenants(id), users(id), locations(id)","1-N
staff_working_hours,"Staff working hours configuration","id, tenant_id, staff_id, day_of_week, start_time, end_time, timezone, created_at, updated_at","Tenant staff access, own record self-read","tenants, users","tenants(id), users(id)","1-N
staff_availability_settings,"Staff availability settings and constraints","id, tenant_id, staff_id, max_hours_per_day, min_break_minutes, created_at","Tenant staff access","tenants, users","tenants(id), users(id)","1-N
external_calendars,"External calendar integrations (Google, Outlook, etc.)","id, tenant_id, staff_id, calendar_type, calendar_url, sync_enabled, last_sync_at, created_at","Tenant staff access, own record self-read","tenants, users","tenants(id), users(id)","1-N
categories,"Driving lesson categories (A, B, C, D, etc.)","id, tenant_id, name, color, description, active, created_at","Public read, tenant staff write","tenants, products","tenants(id)","1-N
products,"Product catalog (lessons, courses, etc.)","id, tenant_id, category_id, name, description, price, active, created_at","Public read, tenant staff write","tenants, categories, product_sales","tenants(id), categories(id)","1-N
product_sales,"Product sales records","id, tenant_id, user_id, product_id, quantity, price, sale_date, created_at","Tenant-based + customer self-read","tenants, users, products","tenants(id), users(id), products(id)","1-N
pricing_rules,"Dynamic pricing rule definitions","id, tenant_id, name, rule_config, active, created_at","Tenant staff write, read","tenants","tenants(id)","1-N
payments,"Payment records","id, tenant_id, user_id, staff_id, appointment_id, course_registration_id, status, amount, payment_method, payment_gateway, reference_number, created_at, updated_at","Tenant-based + customer self-read, service role insert","tenants, users, appointments, course_registrations, payment_items, payment_wallee_transactions, payment_reminders","tenants(id), users(id), appointments(id), course_registrations(id)","1-N
payment_items,"Line items within payments","id, payment_id, description, quantity, unit_price, total, created_at","Inherited from payments RLS","payments","payments(id)","1-N
payment_methods,"Available payment methods for tenant","id, tenant_id, method_type, enabled, config, created_at","Tenant admin write, staff read","tenants","tenants(id)","1-N
payment_wallee_transactions,"Wallee transaction history","id, payment_id, wallee_transaction_id, wallee_space_id, status, response_data, created_at, updated_at","Tenant-based via payment, service role access","payments","payments(id)","1-N
payment_reminders,"Payment reminder tracking","id, tenant_id, payment_id, appointment_id, reminder_stage, sent_at, sent_via, retry_count, next_reminder_at, created_at","Tenant staff read, service role read/write","tenants, payments, appointments","tenants(id), payments(id), appointments(id)","1-N
payment_audit_logs,"Audit trail of payment changes","id, payment_id, user_id, action, changes, created_at","Tenant-based, admin read","payments, users","payments(id), users(id)","1-N
discounts,"Discount definitions","id, tenant_id, name, discount_type, discount_value, active, created_at","Tenant staff write, read","tenants, discount_sales","tenants(id)","1-N
discount_sales,"Discount application records","id, tenant_id, payment_id, discount_id, applied_amount, applied_at","Tenant-based","tenants, payments, discounts","tenants(id), payments(id), discounts(id)","1-N
discount_codes,"Discount code definitions","id, tenant_id, code, discount_id, usage_limit, usage_count, expires_at, created_at","Tenant staff write, public read","tenants, discounts","tenants(id), discounts(id)","1-N
vouchers,"Voucher system","id, tenant_id, name, value, active, created_at","Tenant staff write, read","tenants, voucher_codes, voucher_redemptions","tenants(id)","1-N
voucher_codes,"Individual voucher codes","id, voucher_id, code, used_by_user_id, used_at, created_at","Public read, customer use","vouchers, users","vouchers(id), users(id)","1-N
voucher_redemptions,"Voucher redemption records","id, tenant_id, user_id, voucher_id, amount_redeemed, redeemed_at, created_at","Customer read own, tenant staff read","tenants, users, vouchers","tenants(id), users(id), vouchers(id)","1-N
courses,"Course definitions (VKU, PGS, private)","id, tenant_id, name, description, category, duration_hours, start_date, end_date, status, created_at","Tenant staff write, public read available","tenants, course_categories, course_sessions, course_registrations","tenants(id)","1-N
course_categories,"Course category mappings","id, course_id, category_id, created_at","Tenant staff write","courses, categories","courses(id), categories(id)","1-N
course_sessions,"Individual course session instances","id, course_id, session_number, start_date, start_time, end_time, location_id, staff_id, max_participants, created_at","Tenant staff write, read","courses, locations, users, session_participants","courses(id), locations(id), users(id)","1-N
course_registrations,"Student course enrollments","id, tenant_id, course_id, user_id, status, registration_date, completion_date, payment_id, created_at","Tenant staff write, customer self-read, service role admin","tenants, courses, users, payments, course_participants","tenants(id), courses(id), users(id), payments(id)","1-N
course_participants,"Participant information for courses","id, course_registration_id, first_name, last_name, email, phone, address, created_at","Tenant staff write via course registration","course_registrations","course_registrations(id)","1-N
session_participants,"Session-level participant tracking","id, course_session_id, course_participant_id, attendance_status, created_at","Tenant staff write, read","course_sessions, course_participants","course_sessions(id), course_participants(id)","1-N
invoices,"Invoice records","id, tenant_id, user_id, invoice_number, total_amount, status, issued_date, due_date, paid_date, created_at","Tenant staff write, customer self-read, service role admin","tenants, users, invoice_items, invoice_payments","tenants(id), users(id)","1-N
invoice_items,"Invoice line items","id, invoice_id, description, quantity, unit_price, total, created_at","Inherited from invoice RLS","invoices","invoices(id)","1-N
invoice_payments,"Invoice payment tracking","id, invoice_id, payment_id, amount_paid, paid_date, created_at","Inherited from invoice RLS","invoices, payments","invoices(id), payments(id)","1-N
student_credits,"Student credit balances","id, tenant_id, user_id, balance, created_at, updated_at","Tenant staff read, customer self-read","tenants, users, credit_transactions","tenants(id), users(id)","1-N
credit_transactions,"Credit transaction history","id, credit_id, transaction_type, amount, reference_id, created_at","Inherited from student_credits RLS","student_credits","student_credits(id)","1-N
cash_balances,"Cash balance tracking per staff member","id, tenant_id, staff_id, balance, last_settlement_date, created_at, updated_at","Tenant staff read, own record self-read","tenants, users, cash_transactions","tenants(id), users(id)","1-N
cash_transactions,"Cash transaction records","id, cash_balance_id, transaction_type, amount, reference_id, created_at","Inherited from cash_balances RLS","cash_balances","cash_balances(id)","1-N
cash_movements,"Cash movement logs for auditing","id, tenant_id, from_user_id, to_user_id, amount, reason, movement_date, created_at","Tenant staff read, admin only write","tenants, users","tenants(id), users(id)","1-N
cash_confirmations,"Cash payment confirmations","id, payment_id, confirmed_by_user_id, confirmed_at, receipt_number, created_at","Tenant staff write, customer self-read","payments, users","payments(id), users(id)","1-N
cancellation_policies,"Cancellation policy definitions","id, tenant_id, name, cancellation_fee_percent, cutoff_hours, requires_medical_certificate, active, created_at","Tenant staff write, read","tenants, appointments","tenants(id)","1-N
cancellation_reasons,"Cancellation reason catalog","id, tenant_id, name, description, active, created_at","Public read, tenant staff write","tenants, appointments","tenants(id)","1-N
cancellation_rules,"Cancellation rule definitions","id, tenant_id, policy_id, condition, created_at","Tenant admin write, staff read","tenants, cancellation_policies","tenants(id), cancellation_policies(id)","1-N
evaluation_categories,"Evaluation category definitions","id, tenant_id, name, description, created_at","Tenant staff write, read","tenants, evaluation_criteria","tenants(id)","1-N
evaluation_criteria,"Evaluation criteria for appointments","id, tenant_id, category_id, name, description, max_score, created_at","Tenant staff write, read","tenants, evaluation_categories","tenants(id), evaluation_categories(id)","1-N
evaluation_scale,"Rating scales for evaluation","id, tenant_id, name, scale_values, created_at","Tenant staff write, read","tenants, exam_results","tenants(id)","1-N
exam_results,"Exam result records","id, tenant_id, user_id, examiner_id, result_type, score, date, passed, created_at","Tenant staff write, customer self-read","tenants, users, examiners","tenants(id), users(id), examiners(id)","1-N
examiners,"Examiner information","id, tenant_id, name, license_number, active, created_at","Tenant staff write, read","tenants, exam_results","tenants(id)","1-N
user_documents,"User document storage","id, tenant_id, user_id, document_type, file_path, uploaded_at, expires_at, created_at","User self-read own, tenant staff read","tenants, users, document_categories","tenants(id), users(id)","1-N
document_categories,"Document category definitions","id, tenant_id, name, required, created_at","Tenant staff write, read","tenants, user_documents","tenants(id)","1-N
pendencies,"Task/pendency management","id, tenant_id, user_id, title, description, status, priority, due_date, created_at, updated_at","Tenant staff write/read, assigned user self-read","tenants, users","tenants(id), users(id)","1-N
notes,"Appointment notes","id, tenant_id, appointment_id, user_id, content, created_at, updated_at","Tenant staff write, customer self-read if owner","tenants, appointments, users","tenants(id), appointments(id), users(id)","1-N
booking_reservations,"Temporary slot reservations during booking","id, tenant_id, slot_id, email, status, expires_at, created_at","Public create/update, tenant staff read","tenants, availability_slots","tenants(id), availability_slots(id)","1-N
booking_proposals,"Booking proposals from public pages","id, tenant_id, email, phone, preferred_date, message, status, created_at","Public create, tenant staff read","tenants, locations","tenants(id), locations(id)","1-N
pending_quotes,"Pending quote requests","id, tenant_id, email, message, status, created_at","Public create, tenant staff read","tenants","tenants(id)","1-N
outbound_messages_queue,"Message queue for reminders","id, tenant_id, message_type, recipient, content, status, retry_count, scheduled_for, created_at, processed_at","Service role read/write, tenant staff read","tenants","tenants(id)","1-N
sms_logs,"SMS sending logs","id, tenant_id, payment_id, recipient, message, status, sent_at, created_at","Tenant staff read, service role write","tenants, payments","tenants(id), payments(id)","1-N
reminder_templates,"Email/SMS reminder message templates","id, tenant_id, template_type, subject, body, variables, created_at","Tenant staff write, read","tenants, reminder_logs","tenants(id)","1-N
reminder_logs,"Reminder sending logs","id, tenant_id, template_id, sent_to, sent_via, sent_at, created_at","Tenant staff read, service role write","tenants, reminder_templates","tenants(id), reminder_templates(id)","1-N
sari_sync_logs,"SARI API synchronization logs","id, tenant_id, sync_type, status, records_synced, error_message, synced_at, created_at","Tenant admin read, service role write","tenants","tenants(id)","1-N
sari_customer_mapping,"Mapping between SARI FABERID and Simy users","id, tenant_id, simy_user_id, sari_faberid, sari_name, mapped_at, updated_at","Tenant admin read, service role write","tenants, users","tenants(id), users(id)","1-N
sari_course_mapping,"Mapping between SARI courses and Simy courses","id, tenant_id, sari_course_id, simy_course_id, sari_course_name, synced_at","Tenant staff read, service role write","tenants, courses","tenants(id), courses(id)","1-N
event_types,"Event type definitions for calendar","id, tenant_id, name, color, icon, active, created_at","Tenant staff write, read","tenants","tenants(id)","1-N
invited_customers,"Invited customer records","id, tenant_id, email, invited_by_user_id, invitation_sent_at, accepted_at, created_at","Tenant staff write, invited user self-read","tenants, users","tenants(id), users(id)","1-N
company_billing_addresses,"Company billing address records","id, tenant_id, company_name, street, postal_code, city, country, created_at","Tenant admin write, read","tenants","tenants(id)","1-N
plz_distance_cache,"Postal code distance cache for pricing","id, from_plz, to_plz, distance_km, cached_at","Service role write, public read","--","--","1-N
cron_jobs,"Cron job execution tracking","id, job_name, last_run_at, next_run_at, status, created_at","Service role write, admin read","--","--","1-N
imports_batches,"CSV import batch records","id, tenant_id, batch_name, total_records, successful_records, failed_records, imported_at, created_at","Tenant admin write, read","tenants, imported_customers","tenants(id)","1-N
imported_customers,"Archive of imported customer records","id, tenant_id, batch_id, original_data, imported_as_user_id, import_status, created_at","Tenant admin write, read","tenants, imports_batches, users","tenants(id), imports_batches(id), users(id)","1-N
imported_invoices,"Archive of imported invoice records","id, tenant_id, batch_id, original_data, imported_as_invoice_id, import_status, created_at","Tenant admin write, read","tenants, imports_batches, invoices","tenants(id), imports_batches(id), invoices(id)","1-N
audit_logs,"Application-wide audit trail","id, tenant_id, user_id, table_name, record_id, action, changes, created_at","Tenant staff read, service role write","tenants, users","tenants(id), users(id)","1-N
error_logs,"Error logging for debugging","id, tenant_id, user_id, error_message, stack_trace, context, created_at","Tenant admin read, service role write, super admin full read","tenants, users","tenants(id), users(id)","1-N
webhook_logs,"Webhook processing logs (Wallee, SARI, etc.)","id, tenant_id, webhook_source, event_type, payload, response_status, processed_at, created_at","Tenant admin read, service role write","tenants","tenants(id)","1-N
analytics_events,"Analytics event tracking","id, tenant_id, user_id, event_name, event_data, created_at","Tenant staff read, service role write","tenants, users","tenants(id), users(id)","1-N
system_metrics,"System performance metrics","id, tenant_id, metric_name, metric_value, recorded_at, created_at","Service role write, admin read","tenants","tenants(id)","1-N
tenant_analytics_summary,"Analytics summary per tenant","id, tenant_id, summary_date, active_users, total_appointments, total_payments, created_at","Service role write, tenant admin read","tenants","tenants(id)","1-N
rate_limit_logs,"Rate limiting violation logs","id, tenant_id, user_id, endpoint, ip_address, violation_count, blocked_until, created_at","Service role write, admin read","tenants, users","tenants(id), users(id)","1-N
